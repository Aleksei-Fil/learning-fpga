# Тележка управляемая по ИК (IR) от стандартного пульта ДУ

## Цель проекта

Освоение процесса разработки цифровых схем и конечных автоматов на языке Verilog.

## Задача

Разработать конечный автомат на HDL языке Verilog для удаленного управления подвижной тележкой в составе которой имеется:
- один электромотор с редуктором и приводом на задние колёса;
- один H-мост для управления электромотором.
- один серво-привод [Hitec HS-325HB](https://servodatabase.com/servo/hitec/hs-325hb) для поворота передних колес;
- приемник ИК сигнала [TSOP4336](https://static.chipdip.ru/lib/016/DOC029016184.pdf) (36kHz);
- пара ИК светодиод + ИК фотодиода для определения наличия препятствия;
- плата [TangNano-9K](https://wiki.sipeed.com/hardware/en/tang/Tang-Nano-9K/Nano-9K.html) с микросхемой ПЛИС Gowin GW1NR-9K;
- батарея номинальным напряжением 6В (4xAAA).

## Алгоритм

КА в составе ПЛИС принимате входной сигнал от ИК приемника закодированный в формате RC-5, декодирует его и в зависимости от полученной команды (нажатой клавиши) выполняет следующие действия:
- если нажата клавиша "вверх", то включает мотор на движение вперед;
- если нажата клавиша "вних", то влючает мотор на движение назад;
- если нажата клавиша "влево", то увеличиывает (или уменьшает) скважность ШИМ сигнала на серво-привода для поворота колес влево;
- если нажата клавиша "вправо", то уменьшает (или увеличивает) скважность ШИМ сигнала на серво-привода для поворота колес вправо;
- если нажата клавиша "RETURN", то производится останов вращения двигателя;
- если с ИК фото-диода поступает сигнал, то КА останавливает и недопускает движения вперед, при этом движение назад возможно.

### Управление RC серво-приводом

Станадартные RC-серво управляются шириной импульса, который формируется на её входе с определенной периодичность. Это похоже на ШИМ с апериодичным сигналом. При длительности импулься в 1,5 мс серво устанавливает ротор в нулевое (нейтральное) положение. При подаче импульса длительностью меньше чем 1,5мс, серва уменьшает угол положения ротора (вращает против часовой стрелки). При подаче импульса тлительностью больше чем 1,5мс, серва увеличивает угол положения ротора.

![Алгоритм работы RC-серво](https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/Servomotor_Timing_Diagram.svg/330px-Servomotor_Timing_Diagram.svg.png)

## Ссылки

1. Статья на Хабре "[IR remote control, а без микроконтроллеров можно? Да не вопрос](https://habr.com/ru/companies/timeweb/articles/784500/)"
2. Статья на Wikipedia "[RC-5 Protocol](https://en.wikipedia.org/wiki/RC-5)"
3. Cтатья "[Система ИК ДУ с кодированием](https://radiostorage.net/512-sistema-ik-du-s-kodirovaniem.html)"
   
