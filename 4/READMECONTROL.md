## Моторизированная тележка управляемая по ИК от стандартного пульта ДУ
### Модуль цифровой схемы для управления движением тележки (control)

Этот модуль, основываясь на декодированных команд с пульта ДУ, посылает управляющие сигналы на электродвигатель и сервопривод.
Модуль спроектирован для работы на плате ["Карно"](https://github.com/Fabmicro-LLC/Karnix_ASB-254), на базе ПЛИС Lattice ECP5.

#### Входные параметры:
* clk_hz - частота тактового сигнала ПЛИС (по умолчанию 25МГц);
* sclk_hz - частота работы модуля (по умолчанию 256 Гц).

#### Входные сигналы:
* clk - тактовая частота;
* rst - сигнал сброса;
* ir_ready - сигнал готовности модуля ir_decoder передавать данные;
* can_move_fwd - сигнал, сигнализирующий о возможности движения вперед (впереди нет препятствия).
* command (32-bit) - декодированная команда;

#### Выходные сигналы:
* state - сигнал, сигнализирующий состояние тележки (ON/OFF);
* ctl_valid - сигнал готовности модуля control принимать данные;
* ack - сигнал завершения обработки команды;
* direction - сигнал направления движения (1 - вперед, 0 - назад);
* motor_dc (8-bit) - коэффициент заполнения PWM (ШИМ) электродвигателя;
* servo_dc (8-bit) - коэффициент заполнения PDM.

#### Список команд:
Ниже представлен список команд, которые обрабатывает модуль:

| № команды | 32-битный код | Описание                       | Управляющее воздействие        |
| :-------: | :-----------: | :----------------------------: | :----------------------------: |
| 1         | 0x6897FF00    | Включение системы              | `state <= 1'd1`                |
| 2         | 0x7788FF00    | Выключение системы             | `state <= 1'd0`                |
| 3         | 0x6A95FF00    | Установка направления вперед   | `direction <= 1'd1`            |
| 4         | 0x659AFF00    | Установка направления назад    | `direction <= 1'd0`            |
| 5         | 0x649BFF00    | Поворот серво влево            | `servo_dc <= servo_dc - 8'd32` |
| 6         | 0x6699FF00    | Поворот серво вправо           | `servo_dc <= servo_dc + 8'd32` |
| 7         | 0x7C83FF00    | Увеличение скорости двигателя  | `motor_dc <= motor_dc + 8'd32` |
| 8         | 0x6F90FF00    | Уменьшение скорости двигателя  | `motor_dc <= motor_dc - 8'd32` |
| 9         | 0x619EFF00    | Останов                        | `motor_dc <= 8'd0`             |
| 10        | 0x6D92FF00    | Сброс серво в нейтраль         | `servo_dc <= 8'(servo_center)` |

#### Запуск на ОС Linux:
1. Установить инструментарий: [YosysHQ](https://github.com/YosysHQ/oss-cad-suite-build/releases/), [OpenFPGALoader](https://github.com/trabucayre/openFPGALoader).
2. Установить make.
3. В директории control выполнить `make upload`.
