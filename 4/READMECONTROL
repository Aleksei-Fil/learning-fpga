## Моторизированная тележка управляемая по ИК от стандартного пульта ДУ
### Модуль цифровой схемы для управления движением тележки (control)

Этот модуль, основываясь на декодированных команд с пульта ДУ, посылает управляющие сигналы на электродвигатель и сервопривод.
Модуль спроектирован для работы на плате ["Карно"](https://github.com/Fabmicro-LLC/Karnix_ASB-254), на базе ПЛИС Lattice ECP5.

#### Входные параметры:
* clk_hz - частота тактового сигнала ПЛИС (по умолчанию 25МГц);
* sclk_hz - частота работы модуля (по умолчанию 256 Гц).

#### Входные сигналы:
* clk - тактовая частота;
* rst - сигнал сброса;
* ir_ready - сигнал готовности модуля ir_decoder передавать данные;
* can_move_fwd - сигнал, сигнализирующий о возможности движения вперед (впереди нет препятствия).
* command (32-bit) - декодированная команда;

#### Выходные сигналы:
* state - сигнал, сигнализирующий состояние тележки (ON/OFF);
* ctl_valid - сигнал готовности модуля control принимать данные;
* ack - сигнал завершения обработки команды;
* direction - сигнал направления движения (1 - вперед, 0 - назад);
* motor_dc (8-bit) - коэффициент заполнения PWM (ШИМ) электродвигателя;
* servo_dc (8-bit) - коэффициент заполнения PDM.

#### Список команд:
Ниже представлен список команд, которые обрабатывает модуль:

| № команды | 32-битный код       | Описание                       | Управляющее воздействие                             |
| :---------: | :-----------------: | :----------------------------: | :-------------------------------------------------: |
| 1         | 0xD12FFE01          | Включение системы              | `enable <= 1'd1`                                    |
| 2         | 0xEF11FE01          | Выключение системы             | `enable <= 1'd0`                                    |
| 3         | 0xD52BFE01          | Установка направления вперед   | `direction <= 1'd1`                                 |
| 4         | 0xCB35FE01          | Установка направления назад    | `direction <= 1'd0`                                 |
| 5         | 0xC937FE01          | Поворот серво влево            | `servo_dc <= servo_dc - 8'd8`                       |
| 6         | 0xCD33FE01          | Поворот серво вправо           | `servo_dc <= servo_dc + 8'd8`                       |
| 7         | 0xF907FE01          | Увеличение скорости двигателя  | `motor_dc <= motor_dc + 8'd8`                       |
| 8         | 0xDF21FE01          | Уменьшение скорости двигателя  | `motor_dc <= motor_dc - 8'd8`                       |
| 9         | 0xC33DFE01          | Экстренная остановка           | `motor_dc <= 8'd0`                                  |
| 10        | 0xDB25FE01          | Сброс серво в нейтраль         | `servo_dc <= 8'd127`                                |

#### Запуск на ОС Linux:
1. Установить инструментарий: [YosysHQ](https://github.com/YosysHQ/oss-cad-suite-build/releases/), [OpenFPGALoader](https://github.com/trabucayre/openFPGALoader).
2. Установить make.
3. В директории control выполнить `make`.
